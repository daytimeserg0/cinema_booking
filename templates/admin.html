<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Panel - Cinema Booking</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='admin.css') }}">
</head>
<body>
    <h1>Admin Panel</h1>
    <p>Welcome, {{ session.username }}!</p>
    <p><a href="/">Back to Home</a></p>

    <!-- ---------------- HALLS SECTION ---------------- -->
    <h2>Existing Halls</h2>
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, msg in messages %}
                    {% if category.startswith('delete_hall_') %}
                        <div class="message {{ category }}">{{ msg }}</div>
                    {% endif %}
                {% endfor %}
            {% endif %}
        {% endwith %}
      {% if halls %}
          <table>
              <tr>
                  <th>ID</th>
                  <th>Name</th>
                  <th>Rows</th>
                  <th>Seats per Row</th>
                  <th>Action</th>
              </tr>
              {% for hall in halls %}
              <tr>
                  <td>{{ hall[0] }}</td>
                  <td>{{ hall[1] }}</td>
                  <td>{{ hall[2] }}</td>
                  <td>{{ hall[3] }}</td>
                  <td>
                      <form method="POST" style="display:inline;">
                          <button type="submit" name="delete_hall" class="delete_hall" value="{{ hall[0] }}" onclick="return confirm('Are you sure you want to delete this hall?');">
                              Delete
                          </button>
                      </form>
                  </td>
              </tr>
              {% endfor %}
          </table>
      {% else %}
          <p>No halls available.</p>
      {% endif %}

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, msg in messages %}
                {% if category.startswith('add_hall_') %}
                    <div class="message {{ category }}">{{ msg }}</div>
                {% endif %}
            {% endfor %}
        {% endif %}
    {% endwith %}

    <!-- Button to show the form -->
    <button id="showAddHallForm" class="add_hall">Add New Hall ▼</button>

    <div id="addHallForm" style="display:none; margin-top: 20px;">

        <form method="POST">
            <input type="text" name="name" placeholder="Hall Name" required><br>
            <input type="number" name="rows" placeholder="Number of Rows" min="1" required><br>
            <input type="number" name="seats_per_row" placeholder="Seats per Row" min="1" required><br><br>
            <button type="submit" name="add_hall" class="add_hall">Submit</button>
        </form>
    </div>


    <!-- ---------------- MOVIES SECTION ---------------- -->
    <hr>
    <h2>Existing Movies</h2>
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, msg in messages %}
                {% if category.startswith('delete_movie_') %}
                    <div class="message {{ category }}">{{ msg }}</div>
                {% endif %}
            {% endfor %}
        {% endif %}
    {% endwith %}

    {% if movies %}
        <table>
            <tr>
                <th>ID</th>
                <th>Title</th>
                <th>Description</th>
                <th>Duration (min)</th>
                <th>Poster</th>
                <th>Action</th>
            </tr>
            {% for movie in movies %}
            <tr>
                <td>{{ movie[0] }}</td>
                <td>{{ movie[1] }}</td>
                <td>{{ movie[2] }}</td>
                <td>{{ movie[3] }}</td>
                <td>
                    {% if movie[4] %}
                        <img src="{{ url_for('static', filename='posters/' + movie[4]) }}" alt="Poster" width="60">
                    {% else %}
                        No poster
                    {% endif %}
                </td>
                <td>
                    <form method="POST" style="display:inline;">
                        <button type="submit" name="delete_movie" class="delete_hall" value="{{ movie[0] }}" onclick="return confirm('Are you sure you want to delete this movie?');">
                            Delete
                        </button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </table>
    {% else %}
        <p>No movies available.</p>
    {% endif %}

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, msg in messages %}
                {% if category.startswith('add_movie_') %}
                    <div class="message {{ category }}">{{ msg }}</div>
                {% endif %}
            {% endfor %}
        {% endif %}
    {% endwith %}

    <!-- Button to show movie form -->
    <button id="showAddMovieForm" class="add_hall">Add New Movie ▼</button>

    <div id="addMovieForm" style="display:none; margin-top: 20px;">
        <form method="POST" enctype="multipart/form-data">
            <input type="text" name="title" placeholder="Title" required><br>
            <textarea name="description" placeholder="Description" rows="3" cols="30" required></textarea><br>
            <input type="number" name="duration" placeholder="Duration (minutes)" min="1" required><br>
            <input type="file" name="poster" accept="image/*"><br><br>
            <button type="submit" name="add_movie" class="add_hall">Submit</button>
        </form>
    </div>


    <!-- JS TOGGLES -->
    <script>
        // Toggle hall form
        const btnHall = document.getElementById('showAddHallForm');
        const formHall = document.getElementById('addHallForm');
        btnHall.addEventListener('click', function() {
            const isHidden = formHall.style.display === 'none';
            formHall.style.display = isHidden ? 'block' : 'none';
            btnHall.textContent = isHidden ? "Hide Form ▲" : "Add New Hall ▼";
        });

        // Toggle movie form
        const btnMovie = document.getElementById('showAddMovieForm');
        const formMovie = document.getElementById('addMovieForm');
        btnMovie.addEventListener('click', function() {
            const isHidden = formMovie.style.display === 'none';
            formMovie.style.display = isHidden ? 'block' : 'none';
            btnMovie.textContent = isHidden ? "Hide Form ▲" : "Add New Movie ▼";
        });
    </script>

</body>
</html>
